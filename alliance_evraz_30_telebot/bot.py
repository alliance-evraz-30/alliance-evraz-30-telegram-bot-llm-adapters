import telebot
from telebot.types import Message
from services.process_file import process_zip_file

bot = telebot.TeleBot("8121352331:AAHoZPsN1c471o1_MV1vPGEVKMhT8g58Y_s")


@bot.message_handler(content_types=['document'])
def handle_document(message: Message) -> None:
    if message.document.file_name.endswith('.py'):
        bot.reply_to(message, "–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –º–Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª." + 
                     "–ù–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ —è –∑–∞–Ω–∏–º–∞—é—Å—å —Ä–µ—à–µ–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º." +
                     "–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç —Å–ª–∏—à–∫–æ–º –º–∞–ª, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –≤—Å–µ –∫–∞–∫ –µ—Å—Ç—å." +
                     "–ï—Å–ª–∏ –∂–µ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –ø–æ–º–µ—â–µ–Ω –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª, —Ç–æ —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –∞ –±–µ–¥—Å—Ç–≤–∏–µ. –ü–æ–≤–µ—Ä—å—Ç–µ, –µ–≥–æ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å, —á–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å.\n\n" +
                     "–ü—Ä–∏—à–ª–∏—Ç–µ zip-–∞—Ä—Ö–∏–≤, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã."
        )

        return

    if not message.document.file_name.endswith('.zip'):
        bot.reply_to(message, "–ú–æ–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É." +
                     "–ü–æ—ç—Ç–æ–º—É —è —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞—é —Ç–æ–ª—å–∫–æ Python-–ø—Ä–æ–µ–∫—Ç—ã. –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ!"
        )

        return

    bot.reply_to(message, "–Ø –ø–æ–ª—É—á–∏–ª —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞. –°–ø–∞—Å–∏–±–æ!")

    try:
        result = process_zip_file(
            bot=bot,
            file_id=message.document.file_id,
            file_name=message.document.file_name,
            chat_id=message.chat.id,
        )

        bot.send_message(chat_id=message.chat.id, text=result, parse_mode="markdown")
        bot.send_message(
            chat_id=message.chat.id, 
            text="Code-review –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∫–æ –º–Ω–µ. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å, –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å."
        )

        # with open(pdf_path, "rb") as pdf_file:
        #     bot.send_document(message.chat.id, pdf_file)
    except Exception as e:
        bot.reply_to(message, f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: {str(e)}")

@bot.message_handler(content_types=['photo'])
def handle_photo(message: Message) -> None:
        bot.reply_to(message, "–ú–æ–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É." +
                     "–ü–æ—ç—Ç–æ–º—É —è —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞—é —Ç–æ–ª—å–∫–æ Python-–ø—Ä–æ–µ–∫—Ç—ã. –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ!"
        )

@bot.message_handler(commands=['start'])
def start_message(message: Message) -> None:
    bot.reply_to(message, 
                 "üëã –ü—Ä–∏–≤–µ—Ç!\n\n" +
                 "–Ø ‚Äî –¥—Ä–æ–∏–¥ –ê–ª—å—è–Ω—Å–∞. –ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏ –ø–æ–º–æ—á—å –∏—Ö –∏—Å–ø—Ä–∞–≤–∏—Ç—å. " +
                 "–Ø –Ω–µ –ø–∏—à—É –∫–æ–¥ –∑–∞ –≤–∞—Å, –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é –º–µ–ª–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏ –Ω–µ —è–≤–ª—è—é—Å—å –ª–∏–Ω—Ç–µ—Ä–æ–º. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –ø—Ä–æ–µ–∫—Ç" +
                 "–∫–æ–º–ø–ª–µ–∫—Å–Ω–æ –∏ –ø–æ–º–æ–≥–∞—é –∏–∑–±–µ–∂–∞—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.\n\n" +
                 "–Ø –±—ã–ª —Å–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞ –ï–≤—Ä–∞–∑–∞, –ø–æ—ç—Ç–æ–º—É –ø–æ–ª–∞–≥–∞—é—Å—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –≤–≤–æ–¥–Ω—ã–µ:\n" +
                 "‚Äî –ü—Ä–æ–µ–∫—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Python\n" +
                 "‚Äî –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞" +
                 "\n‚Äî –ü—Ä–æ–µ–∫—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ zip-–∞—Ä—Ö–∏–≤–∞"
    )

@bot.message_handler(func=lambda message: True)
def unknown_command(message: Message) -> None:
    bot.reply_to(message, "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–æ —è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É." +
                 "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∞—Ä—Ö–∏–≤ —Å Python-–ø—Ä–æ–µ–∫—Ç–æ–º, —á—Ç–æ–±—ã —è –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å" +
                 "code-review, –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ /start, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."
    )

if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω.")
    bot.infinity_polling()
